---
layout: post
title: Git学习心得和Git教程整理
tags: Git
categories: Git
published: true
---

#总结

---

## 工作区和暂存区 ##

`工作区`就是你在电脑里能看到git本地库所在的workspace目录

`版本库`工作区有一个隐藏目录`.git`，这个不算工作区，而是Git的版本库

`暂存区`Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区

![title](/static/img/Git学习心得和Git教程整理/工作区暂存区版本库.jpg "title")

暂存操作：

![title](/static/img/Git学习心得和Git教程整理/暂存.jpg "title")

提交操作:

![title](/static/img/Git学习心得和Git教程整理/提交.jpg "title")

---

##基本操作

###初始化仓库

####`git init`命令把这个目录变成Git可以管理的仓库

```bash
	$ git init
	Initialized empty Git repository in /Users/michael/learngit/.git/
```

###添加文件

####`git add`告诉Git，把文件添加到暂存区

```bash
	$ git add readme.txt
```

####`git commit`告诉Git，把文件提交到仓库

```bash
	$ git commit -m "wrote a readme file"
	[master (root-commit) cb926e7] wrote a readme file
	 1 file changed, 2 insertions(+)
	 create mode 100644 readme.txt
```

### 查看文件状态 ###

#### `git status`命令查看仓库当前的状态 ####

```bash
	$ git status
	# On branch master
	# Changes not staged for commit:
	#   (use "git add <file>..." to update what will be committed)
	#   (use "git checkout -- <file>..." to discard changes in working directory)
	#
	#    modified:   readme.txt
	#
	no changes added to commit (use "git add" and/or "git commit -a")
```

#### `git diff`对比文件变更 ####

```bash
	$ git diff readme.txt 
	diff --git a/readme.txt b/readme.txt
	index 46d49bf..9247db6 100644
	--- a/readme.txt
	+++ b/readme.txt
	@@ -1,2 +1,2 @@
	-Git is a version control system.
	+Git is a distributed version control system.
	 Git is free software.
```

### 撤销修改 ###

#### `checkout -- file`可以丢弃工作区的修改 ####

**`git checkout -- file`命令中的`--`很重要，没有`--`，就变成了“切换到另一个分支”的命令,测试不加也可以成功执行放弃更改操作，但是工作区中没有与分支名相同的文件（用github for windows 的powershell测试）**

```bash
	$ git checkout -- readme.txt
```

### 版本回退 ###

#### `git log`可以查看提交历史 ####

```bash
	$ git log
	commit 3628164fb26d48395383f8f31179f24e0882e1e0
	Author: Michael Liao <askxuefeng@gmail.com>
	Date:   Tue Aug 20 15:11:49 2013 +0800
	
	    append GPL
	
	commit ea34578d5496d7dd233c827ed32a8cd576c5ee85
	Author: Michael Liao <askxuefeng@gmail.com>
	Date:   Tue Aug 20 14:53:12 2013 +0800
	
	    add distributed
	
	commit cb926e7ea50ad11b8f9e909c05226233bf755030
	Author: Michael Liao <askxuefeng@gmail.com>
	Date:   Mon Aug 19 17:51:55 2013 +0800
	
	    wrote a readme file
```

```bash
	$ git log --pretty=oneline
	3628164fb26d48395383f8f31179f24e0882e1e0 append GPL
	ea34578d5496d7dd233c827ed32a8cd576c5ee85 add distributed
	cb926e7ea50ad11b8f9e909c05226233bf755030 wrote a readme file
```

#### `git reset`在版本的历史之间切换 ####

```bash
	$ git reset --hard HEAD^
	HEAD is now at ea34578 add distributed
```

```bash
	$ git reset --hard 3628164
	HEAD is now at 3628164 append GPL
```

**`HEAD`指向的就是当前分支（请看分支部分）**

**`HEAD`表示当前版本,上一个版本就是`HEAD^`，上上一个版本就是`HEAD^^`，当然往上100个版本写100个`^`比较容易数不过来，所以写成`HEAD~100`**

回退前：![title](/static/img/Git学习心得和Git教程整理/HEAD1.jpg "title")

回退后：![title](/static/img/Git学习心得和Git教程整理/HEAD2.jpg "title")

#### `git reflog`查看命令历史 ####

```bash
	$ git reflog
	ea34578 HEAD@{0}: reset: moving to HEAD^
	3628164 HEAD@{1}: commit: append GPL
	ea34578 HEAD@{2}: commit: add distributed
	cb926e7 HEAD@{3}: commit (initial): wrote a readme file
```

> 场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令`git checkout --file`。

> 场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令`git reset HEAD file`，就回到了场景1，第二步按场景1操作。

> 场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退,使用命令`git reset HEAD commit_id`回退版本，这个操作也回退到场景1，不过前提是没有推送到远程库。


### 删除文件 ###

#### `git rm`用于删除一个文件 ####

```bash 
	$ git rm test.txt
	rm 'test.txt'
	$ git commit -m "remove test.txt"
	[master d17efd8] remove test.txt
	 1 file changed, 1 deletion(-)
	 delete mode 100644 test.txt
```
> 先执行`rm`命令只能删除当前文件系统的文件，`commmit`后会删除版本库中的文件。

> 如果先执行`git rm`命令，则会删除版本库中的文件，本地会出现一个未追踪的更改（删除的文件）。

> 这里的删除都是逻辑删除，可以通过Git历史还原

---

## 远程仓库 ##

### 链接远程仓库 ###

#### `git clone`命令将远程仓库克隆出新的仓库 ####

```bash
	$ git clone git@github.com:michaelliao/gitskills.git
	Cloning into 'gitskills'...
	remote: Counting objects: 3, done.
	remote: Total 3 (delta 0), reused 0 (delta 0)
	Receiving objects: 100% (3/3), done.
	
	$ cd gitskills
	$ ls
	README.md
```

#### `git remote add`命令将已有的本地仓库与远程仓库关联 ####

```bash
	$ git remote add origin git@github.com:michaelliao/learngit.git
```

**远程库的名字就是origin，这是Git默认的叫法，也可以改成别的**

### 推送到远程仓库 ###

#### `git push`命令把本地库推送到远程 ####

```bash
	$ git push -u origin master
	Counting objects: 19, done.
	Delta compression using up to 4 threads.
	Compressing objects: 100% (19/19), done.
	Writing objects: 100% (19/19), 13.73 KiB, done.
	Total 23 (delta 6), reused 0 (delta 0)
	To git@github.com:michaelliao/learngit.git
	 * [new branch]      master -> master
	 * 
	Branch master set up to track remote branch master from origin.
```

> 远程如果库是空的，第一次推送`master`分支时，加上了`-u`参数，Git不但会把本地的`master`分支内容推送的远程新的`master`分支，还会把本地的`master`分支和远程的`master`分支关联起来，在以后的推送或者拉取时就可以简化命令。
> 
> 只要本地作了提交，就可以通过命令：
> 
> ```bash
> 	$ git push origin master
> ```
> 
> 把本地master分支的最新修改推送至GitHub


***Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快，git协议是ssh协议省去了加密和身份认证的协议，http协议相对最慢。***

---

## 分支 ##

### HEAD和分支图解 ###

#### `HEAD`指向示意 ####

![title](/static/img/Git学习心得和Git教程整理/HEAD.gif "title")

#### 分支切换示意 ####

![title](/static/img/Git学习心得和Git教程整理/branch.gif "title")

## 分支操作 ##

### 创建分支 ###

#### `git checkout`命令加上`-b`参数表示创建并切换 ####

```bash
	$ git checkout -b dev
	Switched to a new branch 'dev'
```

相当于`git branch`创建分支后`git checkout`切换到新分支

```bash
	$ git branch dev
	$ git checkout dev
	Switched to branch 'dev'
```

#### `git branch`命令查看当前分支 ####

```bash
	$ git branch
	* dev
	  master
```

### 合并分支 ###

#### `git merge`命令用于合并指定分支到当前分支 ####

```bash
	$ git merge dev
	Updating d17efd8..fec145a
	Fast-forward
	 readme.txt |    1 +
	 1 file changed, 1 insertion(+)
```

> 合并分支时，加上`--no-ff`参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而f`ast forward`合并就看不出来曾经做过合并。

### 删除分支 ###

#### `git branch -d`命令用于删除分支 ####

```bash
	$ git branch -d dev
	Deleted branch dev (was fec145a).
```

### 分支策略 ###

> **在实际开发中，我们应该按照几个基本原则进行分支管理：**

> 首先，`master`分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；

> 那在哪干活呢？干活都在`dev`分支上，也就是说，`dev`分支是不稳定的，到某个时候，比如1.0版本发布时，再把`dev`分支合并到`master`上，在`master`分支发布1.0版本；

> 你和你的小伙伴们每个人都在`dev`分支上干活，每个人都有自己的分支，时不时地往`dev`分支上合并就可以了。

> 所以，团队合作的分支看起来就像这样：

> ![title](/static/img/Git学习心得和Git教程整理/branchwork.png "title")

---

## 解决冲突 ##

### 冲突形成 ###

#### `master`分支和`feature1`分支各自都分别有新的提交 ####

![title](/static/img/Git学习心得和Git教程整理/branchmodify.png "title")

#### 修改相同文件位置情况下，Git无法执行“快速合并”，只能试图把各自的修改合并起来，但这种合并就可能会有冲突 ####

```bash
	$ git merge feature1
	Auto-merging readme.txt
	CONFLICT (content): Merge conflict in readme.txt
	Automatic merge failed; fix conflicts and then commit the result.
```

### 查看冲突并解决 ###

#### `git status`也可以告诉我们冲突的文件 ####

```bash
	$ git status
	# On branch master
	# Your branch is ahead of 'origin/master' by 2 commits.
	#
	# Unmerged paths:
	#   (use "git add/rm <file>..." as appropriate to mark resolution)
	#
	#       both modified:      readme.txt
	#
	no changes added to commit (use "git add" and/or "git commit -a")
```

#### Git用`<<<<<<<`、`=======`、`>>>>>>>`标记出不同分支的内容 ####

```bash
	Git is a distributed version control system.
	Git is free software distributed under the GPL.
	Git has a mutable index called stage.
	Git tracks changes of files.
	<<<<<<< HEAD
	Creating a new branch is quick & simple.
	=======
	Creating a new branch is quick AND simple.
	>>>>>>> feature1
```

#### 结局后提交文件 ####

```bash
	$ git add readme.txt 
	$ git commit -m "conflict fixed"
	[master 59bc1cb] conflict fixed
```

#### 合并后的示意图 ####

![title](/static/img/Git学习心得和Git教程整理/branchmerge.png "title")

#### `git log --graph --pretty=oneline`也可以看到分支的合并情况 ####

```bash
	$ git log --graph --pretty=oneline --abbrev-commit
	*   59bc1cb conflict fixed
	|\
	| * 75a857c AND simple
	* | 400b400 & simple
	|/
	* fec145a branch test
	...
```

---

## 储藏 ##

> 经常有这样的事情发生，当你正在进行项目中某一部分的工作，里面的东西处于一个比较杂乱的状态，而你
想转到其他分支上进行一些工作。问题是，你不想提交进行了一半的工作，否则以后你无法回到这个工作点。

###  ###

---

#教程

##这个博客的git教程还是不错的,上个面的总结来自这里

[http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000 "这里是廖雪峰的官方网站的Git教程")

##Pro Git教程

Pro Git中文github地址

[https://github.com/progit/progit/tree/master/zh](https://github.com/progit/progit/tree/master/zh "Pro Git教程中文版")

Pro Git 2中文github地址

[https://github.com/progit/progit/tree/master/zh](https://github.com/progit/progit/tree/master/zh "Pro Git 2中文github地址")

或者去我的网盘下载pdf教程 **提取密码:wn45**

[http://pan.baidu.com/s/1pJVoaAR](http://pan.baidu.com/s/1pJVoaAR "Pro Git中文pdf下载")