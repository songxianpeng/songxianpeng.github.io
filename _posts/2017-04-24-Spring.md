---  
lajout: post  
title: Spring  
tags: Spring  
categories: JavaEE  
published: true  
---  

Spring是一个开源的轻量级一站式（对三层都提供了解决技术）框架，核心IOC和AOP

功能：使用JavaBean代替EJB


![spring-overview.png](/static/img/spring/spring-overview.png "spring-overview.png")

核心依赖四个jar包：

* core
* beans
* expression
* context

## IOC

使用new实例创建对象耦合度太高，使用工厂模式仅与工厂耦合

将创建对象的工作交给spring工厂完成

### 原理

* XML配置文件
* dom4j解析
* 工厂设计模式
* 反射

### bean的实例化方式

* 使用类无参构造方法创建
* 使用静态工厂创建
* 使用实例工厂创建

```xml
<!--通过无参构造-->
<bean id="myBean" class="com.xpress.model.MyBean"/>
<!--通过静态工厂-->
<bean id="myBean" class="com.xpress.factory.StaticBeanFactory" factory-method="getBean"/>
<!--通过实例工厂-->
<bean id="factory" class="com.xpress.factory.BeanFactory"/>
<bean id="myBean" factory-bean="factory" factory-method="getBean"/>
```

### XML配置方式

#### 配置文件

* 配置文件：官方建议applicationContext.xml

dtd

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
        "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>
<!-- bean definitions here -->
</beans>
```

schema

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <!-- bean definitions here -->
</beans>
```

#### bean标签

##### 常用属性

* id：名称，不能包含特殊符号
* class：对象全路径
* name：同id，可以包含特殊符号（兼容struts1，已废弃）
* scope
    - singleton：单例的（默认）
    - prototype：多例的
    - request：创建一个bean对象并存入request中
    - session：创建一个bean对象并存入session中
    - globalSession：应用在Portlet环境放到globalSession中，非Portlet环境相当于session

##### 属性注入

注入方式

* set方法注入（spring支持）
* 有参构造注入（spring支持）
* 接口注入（实现指定结口的方法）

###### set方法注入

需要注入的属性必须有相应的set方法

```xml
<bean id="myBean" class="com.xpress.model.MyBean">
    <property name="name" value="xpress"/>
</bean>
<!-- 声明service -->
<bean id="myService" class="com.xpress.service.MyService"/>
<bean id="myAction" class="com.xpress.action.MyAction">
    <!-- 注入service -->
    <property name="myService" ref="myService"/>
</bean>
```

**复杂类型注入**

* 数组
* list集合
* map集合
* properties集合

```xml
<bean id="moreComplexObject" class="example.ComplexObject">
    <!-- results in a setAdminEmails(java.util.Properties) call -->
    <property name="adminEmails">
        <props>
            <prop key="administrator">administrator@example.org</prop>
            <prop key="support">support@example.org</prop>
            <prop key="development">development@example.org</prop>
        </props>
    </property>
    <!-- results in a setSomeList(java.util.List) call -->
    <property name="someList">
        <list>
            <value>a list element followed by a reference</value>
            <ref bean="myDataSource" />
        </list>
    </property>
    <!-- results in a setSomeMap(java.util.Map) call -->
    <property name="someMap">
        <map>
            <entry key="an entry" value="just some string"/>
            <entry key ="a ref" value-ref="myDataSource"/>
        </map>
    </property>
    <!-- results in a setSomeSet(java.util.Set) call -->
    <property name="someSet">
        <set>
            <value>just some string</value>
            <ref bean="myDataSource" />
        </set>
    </property>
</bean>
```

###### 有参构造注入

```xml
<bean id="myBean" class="com.xpress.model.MyBean">
    <constructor-arg name="name" value="xpress"/>
</bean>
```

###### 名称空间p注入

```xml
<!-- 引入名称空间p -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
<bean id="myBean" class="com.xpress.model.MyBean" p:name="xpress"/>
```

### 注解方式

## IOC和DI

* IOC：控制反转，把对象创建交给spring配置
* DI：依赖注入，向对象属性中设置值
* 关系：DI不能单独存在，要在IOC基础上完成

## AOP

面向切面编程


------

*以上概念总结于传智播客Spring课程*