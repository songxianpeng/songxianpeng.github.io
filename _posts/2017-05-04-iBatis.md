---  
lajout: post  
title: iBatis  
tags: iBatis  
categories: JavaEE  
published: true  
---  

通过MyBatis提供的映射方式，自由灵活的生成（半自动，大部分需要程序员编写）满足需求的sql语句，可以将preparedStatement中的输入参数自动进行输入映射，将查询结果集灵活映射成java对象（输出映射）。

## iBatis配置文件

### 主配置文件

默认SqlMapConfig.xml，配置了数据源、事务等MyBatis运行环境

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- 别名配置 -->
    <typeAliases>
        <typeAlias type="com.xpress.model.User" alias="User"/>
    </typeAliases>
    <!-- 和spring整合后不需要配置 -->
    <environments default="development">
        <environment id="development">
            <!-- 使用jdbc事务，由mybatis控制 -->
            <transactionManager type="JDBC"/>
            <!-- 连接池由mybatis管理 -->
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <mapper resource="sqlmap/Users.xml"/>
    </mappers>
</configuration>
```

### 映射文件

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 命名空间用于隔离sql -->
<mapper namespace="Users">
    <resultMap id="UserResultMap" type="User">
        <result property="username" column="username"/>
        <result property="nickName" column="nickName"/>
        <result property="password" column="password"/>
    </resultMap>
    <!-- id标识映射文件中的sql -->
    <select id="selectUser" resultMap="UserResultMap" parameterType="int">
        SELECT *
        FROM users
        WHERE id = #{id}
    </select>
</mapper>
```

* `#{}`标识一个占位符号
    - `#{id}`其中的id标识一个接收输入的参数，参数名称就是id
    - 如果输入参数是简单类型，`#{}`中的参数名可以任意

#### select



## CRUD

### SqlSession

```java
String fileName = "SqlMapConfig.xml";
Reader reader = null;
SqlSession sqlSession = null;
try {
    reader = Resources.getResourceAsReader(fileName);

    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(reader);

    reader.close();

    sqlSession = sqlSessionFactory.openSession();
    User user = sqlSession.selectOne("Users.selectUser", 1);
    System.out.println(user);
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        if (reader != null) {
            reader.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    } finally {
        if (sqlSession != null) {
            sqlSession.close();
        }
    }
}
```

### 查询

```java

```

### queryForList()

### insert()

### delete()

### update()


## 源码分析

* SqlSessionFactory
* SqlSession
* Executor
* MappedStatement

------

*以上概念总结于传智播客iBatis课程*